Linux:
0. Make sure that you have installed python3
1. Setup virtual environment:
python3 -m venv questionnaire-venv
Activate it:
source questionnaire-venv/bin/activate
Download requirements.txt and install packages from it:
python -m pip install -r requirements.txt
2. Create a folder for server
3. Clone this repository:
git clone <repository-url>
If repository changes, you can update your copy:
git pull
4. Change file questionnaire/settings.py:
- Insert secrete keys and passwords to environment variables
- Set Debug = False
- Add your domain into ALLOWED_HOSTS
- Add string after STATIC_URL:
STATIC_ROOT = os.path.join(BASE_DIR, 'static/')
5. Make migrations:
python manage.py makemigrations
python manage.py migrate
python manage.py collectstatic
6. Import data to DB:
python manage.py loaddata questiontype.json
python manage.py loaddata groups.json
7. Create superuser for your project:
python manage.py createsuperuser
Enter username, email (could be passed) and password 2 times.
8. Configure gunicorn
gunicorn is already installed from requirements.txt, so only need to configure it.
Create service file:
sudo nano /etc/systemd/system/gunicorn.service
Which contains:
[Unit]
Description=gunicorn service
After=network.target

[Service]
User=YourUsername
Group=www-data
WorkingDirectory=/your/path/to/project
ExecStart=/your/path/to/env/bin/gunicorn --access-logfile - --workers 3 --bind unix:/your/path/to/project/questionnaire.sock questionnaire.wsgi:application

[Install]
WantedBy=multi-user.target
Dont't forget change user and paths.
Now enable and start srevice:
sudo systemctl enable gunicorn.service
sudo systemctl start gunicorn.service
sudo systemctl status gunicorn.service
If you get some trouble, you can see into journal:
journalctl -u gunicorn
If you changed something, restart service:
sudo systemctl daemon-reload
sudo systemctl restart gunicorn
9. Setup Nginx:
sudo apt install nginx
Create custom config:
sudo nano /etc/nginx/sites-available/questionnaire
Which contains:
server {
    listen 80;
    server_name www.yourdomain.com;
    location = /favicon.ico {access_log off;log_not_found off;}

    location /static/ {
        alias /your/path/to/project/static/; # ended / is required!
    }

    location / {
         include proxy_params;
         proxy_pass http://unix:/your/path/to/project/questionnaire.sock;
    }
}
Press Ctrl+S to save file and Ctrl+X to close it.
Create symlink to enable this file:
sudo ln -s /etc/nginx/sites-available/questionnaire /etc/nginx/sites-enabled
Test:
sudo nginx -t
Start:
sudo service nginx start
If you need to restart or stop:
sudo service nginx restart
sudo service nginx stop
If all do done, it should be works.
